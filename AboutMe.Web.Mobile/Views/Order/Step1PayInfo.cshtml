@model AboutMe.Domain.Entity.Order.ORDER_STEP1_PAYINFO
<script language="javascript">
    StartSmartUpdate();

    var openwin;

    //주문결제
    function payConfirm() {
        var paygbn = $(':radio[name="PAY_GBN"]:checked').val();
        if (paygbn == "1") {
            $("#gopaymethod").val("Card");
        }
        else if (paygbn == "2") //실시간계좌이체
        {
            $("#gopaymethod").val("onlydbank");
        }
        else if (paygbn == "3") //무통장(가상계좌)
        {
            $("#gopaymethod").val("VBank");
        }

        if ($("#SENDER_NAME").val().trim() == "") {
            alert('주문자명을 입력해주세요.');
            $("#SENDER_NAME").setfocus();
            return false;
        }

        if ($("#SENDER_POST1").val().trim() == "" ) {
            alert('우편번호를 입력해주세요.');
            $("#SENDER_POST1").setfocus();
            return false;
        }
        if ($("#SENDER_ADDR1").val().trim() == "") {
            alert('주소를 입력해주세요.');
            $("#SENDER_ADDR1").setfocus();
            return false;
        }
        if ($("#SENDER_ADDR2").val().trim() == "") {
            alert('상세주소를 입력해주세요.');
            $("#SENDER_ADDR2").setfocus();
            return false;
        }
        /*
        if ($("#SENDER_TEL1").val().trim() == "" || $("#SENDER_TEL2").val().trim() == "" || $("#SENDER_TEL3").val().trim() == "") {
            alert('전화번호를 입력해주세요.');
            $("#SENDER_TEL1").setfocus();
            return false;
        }
        */
        if ($("#SENDER_HP1").val().trim() == "" || $("#SENDER_HP2").val().trim() == "" || $("#SENDER_HP3").val().trim() == "") {
            alert('휴대폰번호를 입력해주세요.');
            $("#SENDER_HP1").setfocus();
            return false;
        }
        if ($("#SENDER_EMAIL1").val().trim() == "" || $("#SENDER_EMAIL2").val().trim() == "") {
            alert('이메일주소를 입력해주세요.');
            $("#SENDER_EMAIL1").setfocus();
            return false;
        }


        if ($("#RECEIVER_NAME").val().trim() == "") {
            alert('받으시는분 이름을 입력해주세요.');
            // $("#RECEIVER_NAME").setfocus();
            return false;
        }

        if ($("#RECEIVER_POST1").val().trim() == "") {
            alert('우편번호를 입력해주세요.');
            $("#RECEIVER_POST1").setfocus();
            return false;
        }
        if ($("#RECEIVER_ADDR1").val().trim() == "") {
            alert('주소를 입력해주세요.');
            $("#RECEIVER_ADDR1").setfocus();
            return false;
        }
        if ($("#RECEIVER_ADDR2").val().trim() == "") {
            alert('상세주소를 입력해주세요.');
            $("#RECEIVER_ADDR2").setfocus();
            return false;
        }
        /*
        if ($("#RECEIVER_TEL1").val().trim() == "" || $("#RECEIVER_TEL2").val().trim() == "" || $("#RECEIVER_TEL3").val().trim() == "") {
            alert('전화번호를 입력해주세요.');
            $("#RECEIVER_TEL1").setfocus();
            return false;
        }
        */
        if ($("#RECEIVER_HP1").val().trim() == "" || $("#RECEIVER_HP2").val().trim() == "" || $("#RECEIVER_HP3").val().trim() == "") {
            alert('휴대폰번호를 입력해주세요.');
            $("#RECEIVER_HP1").setfocus();
            return false;
        }

        if ($("#nomem_agree_chk").length > 0) {
            if (!$("#nomem_agree_chk").attr("checked")) {
                alert("비회원 필수입력정보 수집 동의를 선택하여야 합니다.");
                return false;
            }
        }

        if ($("#NOMEMBER_PASS").length > 0) {
            if ($("#NOMEMBER_PASS").val().trim() == "") {
                alert("비회원 비밀번호를 입력하세요.");
                $("#NOMEMBER_PASS").setfocus();
                return false;
            }
        }

        if ($("#mem_agree1_chk").length > 0) {
            if (!$("#mem_agree1_chk").attr("checked")) {
                alert("주문자 동의를 선택하여야 합니다.");
                return false;
            }
        }
        if ($("#mem_agree2_chk").length > 0) {
            if (!$("#mem_agree2_chk").attr("checked")) {
                alert("개인정보 제3자 제공/위탁동의를 선택하여야 합니다.");
                return false;
            }
        }

        $("#buyername").val($("#SENDER_NAME").val().trim());
        $("#buyeremail").val($("#SENDER_EMAIL1").val().trim() + "@@" + $("#SENDER_EMAIL2").val().trim());
        $("#buyertel").val($("#SENDER_HP1").val().trim() + "-" + $("#SENDER_HP1").val().trim() + "-" + $("#SENDER_HP1").val().trim());

        SaveReceiverAddress();
    }

    //주소저장
    function SaveReceiverAddress() {
        var src_url = "/Order/SaveReceiverAddress";
        var param = "ORDER_IDX=@Model.OrderIdx"
        param += "&SENDER_NAME=" + $("#SENDER_NAME").val().trim();
        param += "&SENDER_POST1=" + $("#SENDER_POST1").val().trim();
        //param += "&SENDER_POST2=" + $("#SENDER_POST2").val().trim();
        param += "&SENDER_ADDR1=" + $("#SENDER_ADDR1").val().trim();
        param += "&SENDER_ADDR2=" + $("#SENDER_ADDR2").val().trim();
        param += "&SENDER_TEL1=" + $("#SENDER_TEL1").val().trim();
        param += "&SENDER_TEL2=" + $("#SENDER_TEL2").val().trim();
        param += "&SENDER_TEL3=" + $("#SENDER_TEL3").val().trim();
        param += "&SENDER_HP1=" + $("#SENDER_HP1").val().trim();
        param += "&SENDER_HP2=" + $("#SENDER_HP2").val().trim();
        param += "&SENDER_HP3=" + $("#SENDER_HP3").val().trim();
        param += "&SENDER_EMAIL1=" + $("#SENDER_EMAIL1").val().trim();
        param += "&SENDER_EMAIL2=" + $("#SENDER_EMAIL2").val().trim();

        param += "&RECEIVER_NAME=" + $("#RECEIVER_NAME").val().trim();
        param += "&RECEIVER_POST1=" + $("#RECEIVER_POST1").val().trim();
        //param += "&RECEIVER_POST2=" + $("#RECEIVER_POST1").val().trim();
        param += "&RECEIVER_ADDR1=" + $("#RECEIVER_ADDR1").val().trim();
        param += "&RECEIVER_ADDR2=" + $("#RECEIVER_ADDR2").val().trim();
        param += "&RECEIVER_TEL1=" + $("#RECEIVER_TEL1").val().trim();
        param += "&RECEIVER_TEL2=" + $("#RECEIVER_TEL2").val().trim();
        param += "&RECEIVER_TEL3=" + $("#RECEIVER_TEL3").val().trim();
        param += "&RECEIVER_HP1=" + $("#RECEIVER_HP1").val().trim();
        param += "&RECEIVER_HP2=" + $("#RECEIVER_HP2").val().trim();
        param += "&RECEIVER_HP3=" + $("#RECEIVER_HP3").val().trim();
        param += "&ORDER_MEMO=" + $("#ORDER_MEMO").val().trim();

        if ($("#NOMEMBER_PASS").length > 0) {
            param += "&NOMEMBER_PASS=" + $("#NOMEMBER_PASS").val().trim();
        }

        var frm = document.ini;
        $.ajax({
            cache: false,
            type: "POST",
            url: src_url,
            data: param,
            success: function (data) {
                if (data.result == "true") {
                    //이니시스결제 호출!
                    pay(frm);
                }
                else {
                    if (data.msg != "") {
                        alert(data.msg);
                    }
                }
            },
            complete: function (jqXHR, textStatus) {
            }
        });
    }

    function pay(frm) {
        if ($("#clickcontrol").val() == "enable")
        {
            if ($("#goodname").val() == "")  // 필수항목 체크 (상품명, 상품가격)
            {
                alert("상품명이 빠졌습니다. 필수항목입니다.");
                return false;
            }
            else if (ini_IsInstalledPlugin() == false) {
                alert("\n이니페이 플러그인 128이 설치되지 않았습니다. \n\n안전한 결제를 위하여 이니페이 플러그인 128의 설치가 필요합니다. \n\n다시 설치하시려면 Ctrl + F5키를 누르시거나 메뉴의 [보기/새로고침]을 선택하여 주십시오.");
                return false;
            }
            else {
                if (MakePayMessage(frm)) {
                    disable_click();
                    var sw = screen.availWidth;
                    var sh = screen.availHeight;
                    var width = 300;
                    var height = 150;
                    var px = (sw - width) / 2;
                    var py = (sh - height) / 2;
                    var set = 'top=' + py + ',left=' + px;
                    set += ',width=' + width + ',height=' + height + ',menubar = no, toolbar = no, location = no, status = no, scrollbars = no, resizable = no';

                   // openwin = window.open("/Content/child.html", "childwin", set);
                    document.ini.submit();
                    return true;
                } else {
                    if (IsPluginModule()) {//plugin타입 체크
                        alert("결제를 취소하셨습니다.");
                    }
                    return false;
                }
            }
        }
        else {
            return false;
        }
    }

    function enable_click() {
        $("#clickcontrol").val("enable");
    }

    function disable_click() {
        $("#clickcontrol").val("disable");
    }

    function focus_control() {
        if ($("#clickcontrol").val() == "disable")
            openwin.focus();
    }
</script>
<script language="JavaScript" type="text/JavaScript">
<!--
function MM_reloadPage(init) {  //reloads the window if Nav4 resized
  if (init==true) with (navigator) {if ((appName=="Netscape")&&(parseInt(appVersion)==4)) {
    document.MM_pgW=innerWidth; document.MM_pgH=innerHeight; onresize=MM_reloadPage; }}
  else if (innerWidth!=document.MM_pgW || innerHeight!=document.MM_pgH) location.reload();
}
MM_reloadPage(true);

function MM_jumpMenu(targ,selObj,restore){ //v3.0
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
//-->
</script>

<!-- 결제 정보 -->
<form id="ini" name="ini" method="post" action="/Order/OrderProcess">
    <input type="hidden" id="gopaymethod" name="gopaymethod" value="Card">
    <input type="hidden" id="goodname" name="goodname" value="@Model.GoodName">
    <input type="hidden" id="buyername" name="buyername" value="">
    <input type="hidden" id="buyeremail" name="buyeremail" value="">
    <input type="hidden" id="buyertel" name="buyertel" value="">
    <!--
    SKIN : 플러그인 스킨 칼라 변경 기능 - 5가지 칼라(ORIGINAL/BLUE 중 택1, GREEN, ORANGE, BLUE, KAKKI, GRAY)
    HPP : 컨텐츠 또는 실물 결제 여부에 따라 HPP(1)과 HPP(2)중 선택 적용(HPP(1):컨텐츠, HPP(2):실물)
    Card(0): 신용카드 지불시에 이니시스 대표 가맹점인 경우에 필수적으로 세팅 필요 ( 자체 가맹점인 경우에는 카드사의 계약에 따라 설정) - 자세한 내용은 메뉴얼  참조
    OCB : OK CASH BAG 가맹점으로 신용카드 결제시에 OK CASH BAG 적립을 적용하시기 원하시면 "OCB" 세팅 필요 그 외에 경우에는 삭제해야 정상적인 결제 이루어짐


        va_recept : 현금영수증
    -->
    @{
        //가상계좌 입금예정일
        DateTime dt = DateTime.Now.AddDays(3);
        string vbankDate = dt.ToString("yyyyMMdd");
    }
    <input type="hidden" id="acceptmethod" name="acceptmethod" value="VERIFY(1056313):SKIN(ORIGINAL):HPP(2):va_receipt:Vbank(@vbankDate):">
    <input type="hidden" id="oid" name="oid" size="40" value="@Model.OrderIdx">
    <input type="hidden" id="INIregno" name="INIregno" size="40">

    <input type="hidden" id="ini_encfield" name="ini_encfield" value="@Model.InisysStart.ini_encfield">
    <input type="hidden" id="ini_certid" name="ini_certid" value="@Model.InisysStart.ini_certid">
    <input type="hidden" id="quotainterest" name="quotainterest">
    <input type="hidden" id="paymethod" name="paymethod">
    <input type="hidden" id="cardcode" name="cardcode">
    <input type="hidden" id="cardquota" name="cardquota">
    <input type="hidden" id="rbankcode" name="rbankcode">
    <input type="hidden" id="reqsign" name="reqsign" value="DONE">
    <input type="hidden" id="encrypted" name="encrypted">
    <input type="hidden" id="sessionkey" name="sessionkey">
    <input type="hidden" id="uid" name="uid">
    <input type="hidden" id="sid" name="sid">
    <input type="hidden" id="version" name="version" value="5000">
    <input type="hidden" id="clickcontrol" name="clickcontrol">

    <!--결제정보-->
    <div class="boxtypec pay">
        <h3>결제정보</h3>
        <div class="radio_area">
            <label class="racon" style="width:29%"><input type="radio" name="PAY_GBN" value="1"  checked="checked" title="" /> <span class="txt">신용카드</span></label>
            <label class="racon" style="width:42%"><input type="radio" name="PAY_GBN" value="2" title="" /> <span class="txt">실시간 계좌이체</span></label>
            <label class="racon" style="width:29%"><input type="radio" name="PAY_GBN" value="3" title="" /> <span class="txt">가상계좌</span></label>
        </div>
        <div class="txtcon">
            <p class="tit">주문자 동의</p>
            <div class="boxtypee">
                주문할 상품의 상품명,상품가격,배송정보를 확인하였으며,
                구매에 동의하시겠습니까? (전자상거래법 제 8조 제2항)
            </div>
            <label class="chkcon v2"><input type="checkbox" name="mem_agree1_chk" id="mem_agree1_chk" value="1" title="" /> <span class="txt">동의합니다.</span></label>
        </div>
        <div class="txtcon v2">
            <p class="tit">개인정보 제3자 제공/위탁동의</p>
            <a href="#" class="btn btn_white_h30 v2 btn_agree">약관전체보기</a>
            <label class="chkcon v2 mt10"><input type="checkbox" name="mem_agree2_chk" id="mem_agree2_chk" value="1" title="" /> <span class="txt">동의합니다.</span></label>
        </div>
    </div>
    <!--//결제정보-->
    <!--버튼영역-->
    <div class="btn_group mt20">
        <a href="#none" class="btn btn_white_h40 mr5" style="width:142px;" onclick="cancelOrder();">주문취소</a><a href="#none" class="btn btn_brown_h40" style="width:142px;" onclick="payConfirm();">주문결제</a>
    </div>
    <!--//버튼영역-->
</form>